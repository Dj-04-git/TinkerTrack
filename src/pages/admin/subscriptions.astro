---
import Layout from '../../layouts/Layout.astro';
import PageHeader from '../../components/PageHeader.astro';
import AccessGate from '../../components/AccessGate.astro';

const session = Astro.locals?.session ?? {};
const isLoggedIn = Boolean(session.isLoggedIn);
const isAdmin = Boolean(session.isAdmin);

const tabs = ['Subscriptions', 'Products', 'Reporting', 'Users/contacts', 'Configuration'];
const statuses = ['Quotation', 'quotation sent', 'confirmed'];

const orderLines = [
	{
		product: 'Pulse Analytics Suite',
		quantity: 1,
		unit: 'Month',
		unitPrice: 2400,
		discount: '10%',
		taxes: '15%',
		amount: 2160
	}
];
---

<Layout title="TinkerTrack • Subscriptions" isLoggedIn={isLoggedIn}>
	{
		!isLoggedIn ? (
			<AccessGate
				badge="Login required"
				title="Sign in to view subscriptions"
				description="Admin workspaces are available after you sign in."
			/>
		) : !isAdmin ? (
			<AccessGate
				badge="Admin only"
				title="Admin access required"
				description="Only workspace admins can manage subscription records."
				linkHref="/profile"
				linkText="Go to profile"
				hint="Request admin access from your workspace owner if you need to edit subscriptions."
			/>
		) : (
			<section class="relative overflow-hidden">
				<div class="mx-auto max-w-6xl px-6 py-16">
					<PageHeader
						badge="Subscription console"
						title="Quotation workspace"
						description="Create, send, and confirm subscription quotations for new customers."
					>
						<div slot="actions" class="flex flex-wrap items-center gap-2">
							<button class="btn btn-outline btn-sm">New</button>
							<button class="btn btn-outline btn-sm">Send</button>
							<button class="btn btn-primary btn-sm">Confirm</button>
						</div>
					</PageHeader>

					<div class="mt-10 grid gap-6">
						<div class="card bg-base-200/70 shadow-xl backdrop-blur">
							<div class="card-body gap-6">
								<div class="flex flex-wrap items-center justify-between gap-4">
									<div class="flex flex-wrap items-center gap-2">
										{tabs.map((tab, index) => (
											<span
												class={`badge ${index === 0 ? 'badge-primary' : 'badge-outline'} px-4 py-3 text-sm`}
											>
												{tab}
											</span>
										))}
									</div>
									<a class="btn btn-ghost btn-sm" href="/profile">My profile</a>
								</div>

								<div class="grid gap-6 lg:grid-cols-[minmax(0,1.2fr)_minmax(0,0.8fr)]">
									<div class="grid gap-4">
										<div class="grid gap-2">
											<p class="text-xs uppercase tracking-widest text-base-content/60">Subscription number</p>
											<p class="font-display text-2xl">S-0527</p>
											<p class="text-sm text-base-content/60">Auto-generated when you create a new record.</p>
										</div>

										<div class="grid gap-3 sm:grid-cols-2">
											<label class="form-control">
												<span class="label-text text-sm">Customer</span>
												<select class="select select-bordered bg-base-100/80">
													<option>Harbor SaaS Studio</option>
													<option>Sunward Labs</option>
													<option>New customer…</option>
												</select>
												<a class="link-hover mt-2 text-xs" href="/admin/users">Create new customer</a>
											</label>
											<label class="form-control">
												<span class="label-text text-sm">Quotation template</span>
												<select class="select select-bordered bg-base-100/80">
													<option>Enterprise SaaS</option>
													<option>Usage based</option>
													<option>Annual prepaid</option>
												</select>
											</label>
										</div>
									</div>

									<div class="grid gap-3">
										<label class="form-control">
											<span class="label-text text-sm">Expiration</span>
											<input class="input input-bordered bg-base-100/80" type="text" value="06/30/2026" />
											<span class="label-text-alt text-xs text-base-content/60">Quotation expires if not accepted.</span>
										</label>
										<label class="form-control">
											<span class="label-text text-sm">Recurring plan</span>
											<input class="input input-bordered bg-base-100/80" type="text" value="Monthly" />
										</label>
										<label class="form-control">
											<span class="label-text text-sm">Payment term</span>
											<input class="input input-bordered bg-base-100/80" type="text" value="Immediate payment" />
										</label>
									</div>
								</div>

								<div class="flex flex-wrap items-center justify-between gap-3">
									<div class="flex items-center gap-2">
										<button class="btn btn-outline btn-sm">Order lines</button>
										<button class="btn btn-ghost btn-sm">Other info</button>
									</div>
									<div class="flex flex-wrap items-center gap-2">
										{statuses.map((status, index) => (
											<span
												class={`badge ${index === 0 ? 'badge-secondary' : 'badge-outline'}`}
											>
												{status}
											</span>
										))}
									</div>
								</div>

								<div class="overflow-hidden rounded-2xl border border-base-300/70">
									<div class="grid grid-cols-[minmax(0,1.2fr)_minmax(0,0.5fr)_minmax(0,0.7fr)_minmax(0,0.6fr)_minmax(0,0.6fr)_minmax(0,0.6fr)] bg-base-100/70 px-4 py-3 text-xs uppercase tracking-widest text-base-content/60">
										<span>Product</span>
										<span>Quantity</span>
										<span>Unit price</span>
										<span>Discount</span>
										<span>Taxes</span>
										<span>Amount</span>
									</div>
									{orderLines.map((line) => (
										<div class="grid grid-cols-[minmax(0,1.2fr)_minmax(0,0.5fr)_minmax(0,0.7fr)_minmax(0,0.6fr)_minmax(0,0.6fr)_minmax(0,0.6fr)] border-t border-base-300/70 px-4 py-4 text-sm text-base-content/70">
											<div>
												<p class="font-medium text-base-content">{line.product}</p>
												<p class="text-xs text-base-content/50">{line.unit}</p>
											</div>
											<span>{line.quantity}</span>
											<span>${line.unitPrice}</span>
											<span>{line.discount}</span>
											<span>{line.taxes}</span>
											<span class="font-medium text-base-content">${line.amount}</span>
										</div>
									))}
								</div>
							</div>
						</div>
					</div>
				</div>
			</section>
		)
	}
+</Layout>
