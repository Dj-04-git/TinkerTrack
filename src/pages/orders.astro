---
import Layout from '../layouts/Layout.astro';
import PageHeader from '../components/PageHeader.astro';
import AccessGate from '../components/AccessGate.astro';
import { getOrders } from '../lib/checkout.js';

const session = Astro.locals?.session ?? {};
const isLoggedIn = Boolean(session.isLoggedIn);

const orders = getOrders();
---

<Layout title="TinkerTrack â€¢ Orders" isLoggedIn={isLoggedIn}>
	{
		isLoggedIn ? (
			<section class="relative overflow-hidden">
				<div class="mx-auto max-w-6xl px-6 py-16">
					<PageHeader
						badge="Order history"
						title="All orders"
						description="Track every subscription renewal and invoice in one calm ledger."
					/>

					<div class="mt-10 card bg-base-200/70 shadow-xl backdrop-blur">
						<div class="card-body gap-6">
							<div class="hidden grid-cols-[minmax(0,2fr)_minmax(0,1fr)_minmax(0,0.6fr)] gap-4 text-xs uppercase tracking-widest text-base-content/60 md:grid">
								<span>Order</span>
								<span>Order date</span>
								<span>Total</span>
							</div>
							<div class="grid gap-4">
								{orders.map((order) => (
									<a
										class="grid gap-3 rounded-2xl border border-base-300/70 bg-base-100/70 p-4 transition hover:shadow-lg md:grid-cols-[minmax(0,2fr)_minmax(0,1fr)_minmax(0,0.6fr)] md:items-center"
										href={`/orders/${order.id}`}
									>
										<div class="flex flex-col gap-1">
											<span class="font-semibold">{order.id}</span>
											<span class="text-sm text-base-content/60">{order.subscription}</span>
										</div>
										<div class="text-sm text-base-content/70">{order.date}</div>
										<div class="flex items-center justify-between text-sm md:justify-start">
											<span class="font-semibold">${order.total}</span>
											<span class="badge badge-outline ml-3">{order.status}</span>
										</div>
									</a>
								))}
							</div>
						</div>
					</div>
				</div>
			</section>
		) : (
			<AccessGate
				badge="Login required"
				title="Sign in to view your orders"
				description="Order history is available after you log in."
			/>
		)
	}
</Layout>
