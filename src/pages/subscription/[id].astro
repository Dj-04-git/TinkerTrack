---
export const prerender = false;
import Layout from '../../layouts/Layout.astro';
import SubscriptionDetailCard from '../../components/SubscriptionDetailCard.astro';
import { getSubscriptions, getSubscriptionById } from '../../lib/subscriptions.js';

export const getStaticPaths = () =>
	getSubscriptions().map((subscription) => ({
		params: { id: subscription.id },
		props: { subscription }
	}));

const session = Astro.locals?.session ?? {};
const isLoggedIn = Boolean(session.isLoggedIn);
const isAdmin = Boolean(session.isAdmin);

const { subscription } = Astro.props;
const activeSubscription = subscription ?? getSubscriptionById(Astro.params.id);
---

<Layout title={`TinkerTrack â€¢ ${activeSubscription?.name ?? 'Subscription'}`} isLoggedIn={isLoggedIn} isAdmin={isAdmin}>
	<section class="relative overflow-hidden">
		<div class="pointer-events-none absolute inset-0">
			<div class="absolute -top-24 left-10 h-72 w-72 rounded-full bg-primary/20 blur-3xl"></div>
			<div class="absolute bottom-0 right-10 h-80 w-80 rounded-full bg-secondary/20 blur-3xl"></div>
		</div>

		<div class="mx-auto max-w-6xl px-6 py-10">
			<div class="text-sm text-base-content/60">
				<a class="link-hover" href="/shop">All subscriptions</a>
				<span class="px-2">/</span>
				<span>{activeSubscription?.name ?? 'Subscription'}</span>
			</div>
		</div>
	</section>

	<section>
		<div class="mx-auto grid max-w-6xl gap-10 px-6 pb-16 lg:grid-cols-[minmax(0,1.1fr)_minmax(0,0.9fr)]">
			<div class="grid gap-6">
				<div class="rounded-3xl border border-base-200/70 bg-base-200/60 p-6 shadow-lg">
					<div class="aspect-[4/3] w-full rounded-2xl bg-base-100/70">
						<div class="flex h-full w-full items-center justify-center text-sm text-base-content/60">
							Preview image
						</div>
					</div>
				</div>
				<div class="grid gap-4 sm:grid-cols-3">
					{[1, 2, 3].map((index) => (
						<div class="rounded-2xl border border-base-200/70 bg-base-200/60 p-4">
							<div class="flex h-24 items-center justify-center text-xs text-base-content/60">
								Thumbnail {index}
							</div>
						</div>
					))}
				</div>
			</div>

			<div class="lg:sticky lg:top-24">
				{activeSubscription ? (
					<SubscriptionDetailCard subscription={activeSubscription} />
				) : (
					<div class="card bg-base-200/70 shadow-xl backdrop-blur">
						<div class="card-body">
							<h2 class="font-display text-2xl">Subscription not found</h2>
							<p class="text-base-content/70">Return to the shop to select a plan.</p>
							<a class="btn btn-primary" href="/shop">Back to shop</a>
						</div>
					</div>
				)}
			</div>
		</div>
	</section>
</Layout>
